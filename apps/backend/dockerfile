FROM node:22

#install pnpm globally
RUN npm i -g pnpm@9.15.9

#Setting app directory
WORKDIR /app

#copy package.json and package-lock.json
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./

COPY apps/backend/package.json apps/backend/package.json

#install dependencies
RUN pnpm install --frozen-lockfile --prod=false

COPY apps/backend apps/backend

WORKDIR /app/apps/backend

ENV PORT=4000
EXPOSE 4000

CMD ["pnpm", "start"]